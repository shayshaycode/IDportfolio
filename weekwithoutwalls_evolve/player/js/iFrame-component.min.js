"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[9723],{9195:(e,t,n)=>{var s=n(84994),o=n(34398)(n(16950));const i=n(33259),r=n(63269),p=n(8930),a=n(56786),c=n(52635),m=n(54771),l=n(16842),{bool:h,func:d,string:u,object:_}=n(60216),g=n(27378),{Component:f}=n(84335),C=n(88153),b=n(17290),y=n(67209),v=n(22810),w=l({displayName:"IFrame",propTypes:{component:_.isRequired,screenSize:u.isRequired,styles:_,isPageReady:h,setComponentAsReady:d.isRequired,setComponentAsViewed:d.isRequired,setComponentAsComplete:d.isRequired},getInitialState:()=>({_height:null}),componentDidMount(){window.addEventListener("resize",this.onWindowResize),"content"===this.props.component._setCompletionOn&&this.createMessageChannel()},componentWillUnmount(){window.removeEventListener("resize",this.onWindowResize),this.closeMessageChannel()},UNSAFE_componentWillReceiveProps({screenSize:e,component:t}){e!==this.props.screenSize&&this.props.component._isReady&&this.setIframeHeight(),t._setCompletionOn!==this.props.component._setCompletionOn&&("content"===t._setCompletionOn?(this.createMessageChannel(),this.setupIframeCommunication()):this.closeMessageChannel())},onWindowResize:i((function(){this.setIframeHeight(!0)}),100),onIFrameLoaded(){this.setIframeHeight(),this.props.setComponentAsReady(this.props.component._id),"content"===this.props.component._setCompletionOn&&this.setupIframeCommunication()},createMessageChannel(){this._channel=new MessageChannel},closeMessageChannel(){this._channel&&(this._channel.port1.close(),this._channel.port2.close(),this._channel=null)},setupIframeCommunication(){this._channel.port1.onmessage=e=>["completed","complete"].includes(e.data.toLowerCase?.())?this.props.setComponentAsComplete(this.props.component._id):null,this._iframe?.contentWindow.postMessage("Evolve calling!","*",[this._channel.port2])},setIframeHeight(e=!1){const t=()=>this.setState({_height:this.getIframeHeight()});if(e)return t();setTimeout(t,400)},getIframeHeight(){const{_iframeHeightSelector:e}=this.props.component;let t=0;if(e)return t=s(this._iframe).contents().find(e).height(),t;try{const e=this._iframe.contentDocument||this._iframe.contentWindow.document,{body:n,documentElement:s}=e;t=Math.max(n.scrollHeight,n.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight)}catch(e){}return t},onVisibilityChange(...e){const t="content"===this.props.component._setCompletionOn?this.props.setComponentAsViewed:this.props.setComponentAsComplete;b(...e,this,t)},getAttributes(){const{component:e}=this.props;return e._isEmbeddedFile?{src:v(e._embed)}:e._source?.includes("</iframe>")?this.extractAttributesFromSource(e._source):{src:e._source}},extractAttributesFromSource(e){if(!e)return;const t=s(s.parseHTML(e.trim()));if(!t.length||!t.is("iframe"))return;if(!this.props.component._useIframeAttributes){const e=a(t[0].attributes,{name:"src"})?.value;return{src:e}}const n={};return p(t[0].attributes,(e=>{if("style"===e.name){const t=e.value.split(";");return n.style={},void p(t,(e=>{if(!e)return;let[t,s]=e.split(/:(.+)/);t=r(t).trim().camelCase().replace("-","").value(),s=m(s),n.style[t]=s}))}n[e.name]=e.value})),n},getStyle(){const{state:e,props:t}=this,{screenSize:n,component:s}=t,o={width:"100%"};return s._isHeightBasedOnContent&&e._height?(o.height=e._height,o):(o.height="small"===n?`${s._frameHeight._mobile}px`:`${s._frameHeight._desktop}px`,o)},renderIframe(){const e=this.getAttributes();if(!e?.src)return;e.style||(e.style=this.getStyle());const{component:t}=this.props;return t._useIframeAttributes&&!t._isEmbeddedFile||(e.allow="camera; microphone"),g.createElement("iframe",(0,o.default)({key:c(e).length,title:t.iFrameTitle,ref:e=>this._iframe=e,onLoad:this.onIFrameLoaded},e))},render(){const{props:e}=this,t=C(e,"content"===e.component._setCompletionOn?"_hasBeenViewed":"_isComplete");return g.createElement(f,{component:e.component,styles:e.styles,onVisibilityChange:this.onVisibilityChange,isVisibilitySensorActive:t},g.createElement("div",{className:y(e.component)},this.renderIframe()))}});e.exports=w},65241:(e,t,n)=>{const{registerComponent:s}=n(59671);s("iFrame",{component:n(9195),trackingMap:n(98074)})},98074:e=>{e.exports={_interactionType:{type:"String",default:"presentation",shouldRestore:!1}}},88153:e=>{e.exports=(e,t="_hasBeenViewed")=>{const{component:n,isPageReady:s}=e;return!0===s&&!0===n._isReady&&!0!==n[t]}},67209:(e,t,n)=>{const s=n(95685);e.exports=e=>s(`ev-${e._component}-widget ev-component-widget ev-clearfix`,{"ev-disabled":!e._isEnabled,"ev-complete ev-show-user-answer":e._isComplete&&!e._isEnabled,"ev-correct":e._isCorrect&&!e._isEnabled,"ev-submitted":e._isSubmitted})},17290:e=>{e.exports=function(e,t,n,s,o){s&&s.props&&s.props.component?(t.top&&(s.isInviewTop=!0),t.bottom&&(s.isInviewBottom=!0),s.isInviewTop&&s.isInviewBottom&&o&&o(s.props.component._id)):console.error("No component reference passed to helpers/visibilityChangeHandler")}}}]);